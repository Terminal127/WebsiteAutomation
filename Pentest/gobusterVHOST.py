import os
import subprocess

# Function to list available wordlists in a directory
def list_wordlists(directory):
    wordlists = os.listdir(directory)
    return wordlists

# Function to add an entry to the hosts file
def add_to_hosts_file(ip, hostname):
    with open('/etc/hosts', 'a') as hosts_file:
        hosts_file.write(f"{ip} {hostname}\n")
    print(f"\033[92mEntry for {ip} ({hostname}) added to hosts file.\033[0m")  # Green color

# Define the path to the wordlists directory
wordlist_dir = "/usr/share/seclists/Discovery/DNS"

# List available wordlists in the directory
available_wordlists = list_wordlists(wordlist_dir)

# Display available wordlists to the user
print("\033[92mAvailable wordlists in /usr/share/seclists/Discovery/DNS:\033[0m") # Green color
for i, wordlist in enumerate(available_wordlists, start=1):
    print(f"{i}. {wordlist}")

# Get the index of the selected wordlist
while True:
    try:
        wordlist_index = int(input("\033[92mEnter the number of the wordlist to use:\033[0m"))
        if 1 <= wordlist_index <= len(available_wordlists):
            break
        else:
            print("\033[91mInvalid choice. Please select a valid number.\033[0m")  # Red color
    except ValueError:
        print("\033[91mInvalid input. Please enter a number.\033[0m")  # Red color

# Get the file extensions to search for
extensions = input("\033[92mEnter file extensions to search for (comma-separated, e.g., php,html,htm):\033[0m").strip().split(',')
extensions = [ext.strip() for ext in extensions]

# Get the IP address and website name
target_ip = input("Enter the target IP address: ").strip()
website_name = input("Enter the target website name (e.g., http://example.com): ").strip()

# Check if the IP address is already in the hosts file
with open('/etc/hosts', 'r') as hosts_file:
    hosts_content = hosts_file.read()
    if f"{target_ip}    {website_name}" not in hosts_content:
        add_to_hosts = input(f"\033[92mDo you want to add an entry for {target_ip} in your hosts file (Y/N)?\033[0m").strip().lower()
        if add_to_hosts == 'y':
            add_to_hosts_file(target_ip, website_name)

# Build the Gobuster directory fuzzing command
wordlist_path = os.path.join(wordlist_dir, available_wordlists[wordlist_index - 1])
gobuster_dir_command = ["gobuster", "dir", "-u", website_name, "-w", wordlist_path, "-x", ",".join(extensions)]
host_target_url = input("Enter the target URL for vhost fuzzing (e.g., http://example.com): ").strip()

# domain fuzzing
gobuster_vhost_command = ["gobuster", "vhost", "-w", wordlist_path, "-u", website_name]

# Build the Gobuster vhost command with --append-domain
gobuster_vhost_command_append = ["gobuster", "vhost", "--append-domain", "-w", wordlist_path, "-u", host_target_url]

# Function to run Gobuster commands gracefully
def run_gobuster(command):
    try:
        subprocess.run(command, check=True)
        print("\033[92mCommand executed successfully.\033[0m")  # Green color for success
    except subprocess.CalledProcessError as e:
        print(f"\033[91mError running gobuster: {e}\033[0m")  # Red color for error
    except FileNotFoundError:
        print("\033[91mgobuster command not found. Make sure it's installed and in your PATH.\033[0m")  # Red color for error
    except KeyboardInterrupt:
        print("\033[93mKeyboard interrupt detected, terminating.\033[0m")  # Yellow color for interrupt
    finally:
        print("===============================================================")
        print("Yeah, I know you don't have any patience and you pressed Ctrl + C")
        print("===============================================================")

# Ask the user to choose between Gobuster DNS and Gobuster vhost
while True:
    choice = input("Choose an option (DNS/VHOST/APPENDVH): ").strip().lower()
    if choice == 'dns':
        run_gobuster(gobuster_dir_command)
        break
    elif choice == 'vhost':
        run_gobuster(gobuster_vhost_command)
        break
    elif choice == 'appendvh':
        run_gobuster(gobuster_vhost_command_append)
        break
    else:
        print("\033[91mInvalid choice. Please choose either DNS, VHOST, or APPENDVH.\033[0m")

